networks:
  traefik-proxy:
    external: true

services:
  wireguard:
    image: lscr.io/linuxserver/wireguard:latest
    container_name: wireguard
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
      - SYS_MODULE #optional
    environment:
      PUID: ${WG_UID:?WG_UID is not set}
      PGID: ${WG_GID:?WG_GID is not set}
      TZ: ${TZ:?TZ is not set}
      SERVERURL: wgvpn.${TRAEFIK_BASE_DOMAIN:?TRAEFIK_BASE_DOMAIN is not set}
      SERVERPORT: 51820 #optional
      PEERS: 1 #optional
      PEERDNS: auto
      INTERNAL_SUBNET: 10.13.13.0 #optional
      ALLOWEDIPS: 0.0.0.0/0 #optional
      PERSISTENTKEEPALIVE_PEERS:  #optional
      LOG_CONFS: true #optional
    network_mode: host
    volumes:
      - ${WG_CONFIG_DIR:?WG_CONFIG_DIR is not set}:/config
      - /lib/modules:/lib/modules:ro
    ports:
      - 51820:51820/udp
    # sysctls:
    #   - net.ipv4.conf.all.src_valid_mark=1
